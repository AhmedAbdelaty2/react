<!DOCTYPE html>
<html>
<head>
    <meta http-equiv='Content-type' content='text/html; charset=utf-8'>
    <title>Context Example</title>
    <link rel="stylesheet" href="../shared/css/base.css" />
</head>
<body>
<h1>Basic Example</h1>
<div id="container">
    <p>
        To install React, follow the instructions on
        <a href="https://github.com/facebook/react/">GitHub</a>.
    </p>
    <p>
        If you can see this, React is not working right.
        If you checked out the source from GitHub make sure to run <code>grunt</code>.
    </p>
</div>
<h4>Example Details</h4>
<p>This is written in vanilla JavaScript (without JSX) and transformed in the browser.</p>
<p>
    Learn more about React at
    <a href="https://facebook.github.io/react" target="_blank">facebook.github.io/react</a>.
</p>
<script src="../shared/thirdparty/es5-shim.min.js"></script>
<script src="../shared/thirdparty/es5-sham.min.js"></script>
<script src="../shared/thirdparty/console-polyfill.js"></script>
<script src="../../build/react.js"></script>
<script>
    var Elapsed = React.createClass({
        contextTypes: {
            elapsed: React.PropTypes.number.isRequired
        },
        shouldComponentUpdate: function(nextProps, nextState, nextContext) {
            return true;
        },
        render: function() {
            var elapsed = Math.round(this.context.elapsed  / 100);
            var seconds = elapsed / 10 + (elapsed % 10 ? '' : '.0' );
            var message =
                    'React has been successfully running (via context!) for ' + seconds + ' seconds.';

            return React.createElement('div', null, React.createElement('p', null, message));
        }
    });

    // Swapper is a brute force tester to make sure context data flow is working correctly
    // with:
    //   1. intermediate components preventing updates
    //   2. intermediate components being mounted/unmounted continuously
    var Swapper = React.createClass({
        contextTypes: {
            elapsed: React.PropTypes.number.isRequired
        },
        shouldComponentUpdate: function(nextProps, nextState, nextContext) {
            var elapsed = Math.round(this.context.elapsed  / 100);

            return elapsed % 10 < 7;
        },
        render: function() {
            var elapsed = Math.round(this.context.elapsed  / 100);

            return React.createElement(elapsed % 10 < 7 ? 'div' : 'span', null, React.createElement(Elapsed));
        }
    });

    var Container = React.createClass({
        render: function() {
            this.__renderNum__ = (this.__renderNum__ || 0) + 1;

            return React.createElement('div', null, [
                React.createElement('p', null, [
                    React.createElement('span', null, "Middle container has been updated " + this.__renderNum__ + " times."),
                    React.createElement('br'),
                    React.createElement('span', null, "Hopefully the above should only ever say 1 if we are efficiently handling context updates! And the counter should be doing it's thing below!")
                ]),
                React.createElement(Swapper)
            ]);
        }
    });

    var ExampleApplication = React.createClass({
        propTypes: {
            elapsed: React.PropTypes.number.isRequired
        },
        shouldComponentUpdate: function() {
            return false;
        },
        childContextTypes: {
            elapsed: React.PropTypes.number
        },
        shouldUpdateChildContext: function(nextProps, nextState, nextContext) {
            return true;
        },
        getChildContext: function() {
            return {
                elapsed: this.props.elapsed
            };
        },
        render: function() {
            return React.createElement(Container);
        }
    });

    var start = new Date().getTime();
    var iterations = 0;
    setInterval(function() {
        var elapsed = new Date().getTime() - start;

        React.render(
            React.createElement(ExampleApplication, {elapsed: elapsed, iterations: ++iterations}),
            document.getElementById('container')
        );
    }, 50);
</script>
</body>
</html>
